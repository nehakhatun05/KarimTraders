"use strict";(()=>{var e={};e.id=9684,e.ids=[9684],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},32701:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>v,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>y});var s={};t.r(s),t.d(s,{GET:()=>d,POST:()=>p});var i=t(95419),a=t(69108),o=t(99678),n=t(78070),c=t(81355),l=t(82002),u=t(34490);async function d(e){try{let{searchParams:r}=new URL(e.url),t=parseInt(r.get("page")||"1"),s=parseInt(r.get("limit")||"12"),i=(t-1)*s,a=r.get("category"),o=r.get("search"),c=r.get("minPrice"),l=r.get("maxPrice"),d="true"===r.get("organic"),p="true"===r.get("featured"),g="true"===r.get("bestseller"),m="true"===r.get("inStock");r.get("rating");let w=r.get("sortBy")||"createdAt",h=r.get("sortOrder")||"desc",f={isActive:!0};a&&(f.category={slug:a}),o&&(f.OR=[{name:{contains:o,mode:"insensitive"}},{description:{contains:o,mode:"insensitive"}},{tags:{has:o.toLowerCase()}}]),(c||l)&&(f.price={},c&&(f.price.gte=parseFloat(c)),l&&(f.price.lte=parseFloat(l))),d&&(f.isOrganic=!0),p&&(f.isFeatured=!0),g&&(f.isBestSeller=!0),m&&(f.stockStatus="IN_STOCK");let y={};"price"===w?y.price=h:"name"===w?y.name=h:"discount"===w?y.discount="desc":y.createdAt=h;let[v,x]=await Promise.all([u.Z.product.findMany({where:f,skip:i,take:s,orderBy:y,include:{category:{select:{id:!0,name:!0,slug:!0}},images:{orderBy:{sortOrder:"asc"}},_count:{select:{reviews:!0}}}}),u.Z.product.count({where:f})]),P=await Promise.all(v.map(async e=>{let r=await u.Z.review.aggregate({where:{productId:e.id},_avg:{rating:!0}});return{...e,averageRating:r._avg.rating||0,reviewCount:e._count.reviews}}));return n.Z.json({products:P,pagination:{page:t,limit:s,total:x,totalPages:Math.ceil(x/s),hasMore:t*s<x}})}catch(e){return console.error("Products fetch error:",e),n.Z.json({error:"Failed to fetch products"},{status:500})}}async function p(e){try{let r=await (0,c.getServerSession)(l.L);if(!r?.user?.id)return n.Z.json({error:"Unauthorized - Please login"},{status:401});let t=await u.Z.user.findUnique({where:{id:r.user.id},select:{role:!0}});if(!t||!["ADMIN","SUPER_ADMIN"].includes(t.role))return n.Z.json({error:"Forbidden - Admin access required"},{status:403});let s=await e.json(),i=s.sku||`KT-${Date.now()}`,a=await u.Z.product.create({data:{name:s.name,slug:s.slug||s.name.toLowerCase().replace(/\s+/g,"-"),description:s.description,shortDescription:s.shortDescription,price:s.price,originalPrice:s.originalPrice,discount:s.discount||0,unit:s.unit||"1 kg",sku:i,barcode:s.barcode,stockCount:s.stockCount||0,stockStatus:s.stockStatus||"IN_STOCK",isActive:s.isActive??!0,isFeatured:s.isFeatured||!1,isBestSeller:s.isBestSeller||!1,isOrganic:s.isOrganic||!1,isNew:s.isNew||!1,categoryId:s.categoryId,tags:s.tags||[],images:{create:s.images?.map((e,r)=>({url:e.url,alt:e.alt||s.name,sortOrder:r}))||[]},nutrition:s.nutrition?{create:s.nutrition}:void 0},include:{category:!0,images:!0,nutrition:!0}});return n.Z.json(a,{status:201})}catch(e){return console.error("Product creation error:",e),n.Z.json({error:"Failed to create product"},{status:500})}}let g=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:"app/api/products/route"},resolvedPagePath:"C:\\Users\\basan\\Desktop\\karim123\\KarimTraders\\src\\app\\api\\products\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:w,serverHooks:h,headerHooks:f,staticGenerationBailout:y}=g,v="/api/products/route";function x(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:w})}},82002:(e,r,t)=>{t.d(r,{L:()=>c});var s=t(65822),i=t(86485),a=t(10375),o=t(7529),n=t(34490);let c={adapter:(0,s.N)(n.Z),providers:[(0,a.Z)({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||""}),(0,i.Z)({name:"credentials",credentials:{identifier:{label:"Email or Phone",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){let r;if(!e?.identifier||!e?.password)throw console.log("Missing credentials"),Error("Please enter your email/phone and password");let t=e.identifier.trim();console.log("Login attempt with identifier:",t);let s=t.includes("@");if(console.log("Is email:",s),s)r=await n.Z.user.findUnique({where:{email:t}});else{let e=t.replace(/\s+/g,"").replace(/^\+91/,"").replace(/^91/,"");console.log("Looking for phone:",e),r=await n.Z.user.findFirst({where:{OR:[{phone:t},{phone:e},{phone:`+91${e}`},{phone:`91${e}`}]}})}if(console.log("User found:",r?"Yes":"No"),!r||!r.password)throw Error("No account found with this email/phone");if(!await o.ZP.compare(e.password,r.password))throw console.log("Password invalid for user:",r.email),Error("Incorrect password");if(!r.isActive)throw Error("Your account has been disabled");return console.log("Login successful for:",r.email),{id:r.id,email:r.email,name:r.name,image:r.image,role:r.role}}})],session:{strategy:"jwt",maxAge:2592e3},callbacks:{jwt:async({token:e,user:r,trigger:t,session:s})=>(r&&(e.id=r.id,e.role=r.role),"update"===t&&s&&(e.name=s.name,e.image=s.image),e),session:async({session:e,token:r})=>(e.user&&(e.user.id=r.id,e.user.role=r.role),e)},pages:{signIn:"/login",error:"/login"},events:{async createUser({user:e}){await n.Z.wallet.create({data:{userId:e.id,balance:100}}),await n.Z.notification.create({data:{userId:e.id,type:"SYSTEM",title:"Welcome to KARIM TRADERS!",message:"Your account has been created successfully. Enjoy â‚¹100 welcome bonus in your wallet!"}})}},debug:!1}},34490:(e,r,t)=>{t.d(r,{Z:()=>a,_:()=>i});var s=t(53524);let i=globalThis.prisma??new s.PrismaClient({log:["error"]}),a=i}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,6206,7529,244],()=>t(32701));module.exports=s})();