"use strict";(()=>{var e={};e.id=6039,e.ids=[6039],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},70924:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>w,originalPathname:()=>y,patchFetch:()=>P,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>v});var s={};r.r(s),r.d(s,{DELETE:()=>l,GET:()=>c,PUT:()=>d});var o=r(95419),i=r(69108),a=r(99678),u=r(78070),n=r(34490);async function c(e,{params:t}){try{let e=await n.Z.product.findUnique({where:{slug:t.slug},include:{category:{select:{id:!0,name:!0,slug:!0}},images:{orderBy:{sortOrder:"asc"}},nutrition:!0,reviews:{include:{user:{select:{id:!0,name:!0,image:!0}}},orderBy:{createdAt:"desc"},take:10},_count:{select:{reviews:!0}}}});if(!e)return u.Z.json({error:"Product not found"},{status:404});let r=await n.Z.review.aggregate({where:{productId:e.id},_avg:{rating:!0}}),s=await n.Z.product.findMany({where:{categoryId:e.categoryId,id:{not:e.id},isActive:!0},take:4,include:{images:{take:1},_count:{select:{reviews:!0}}}});return u.Z.json({...e,averageRating:r._avg.rating||0,reviewCount:e._count.reviews,relatedProducts:s})}catch(e){return console.error("Product fetch error:",e),u.Z.json({error:"Failed to fetch product"},{status:500})}}async function d(e,{params:t}){try{let r=await e.json(),s=await n.Z.product.update({where:{slug:t.slug},data:{name:r.name,description:r.description,shortDescription:r.shortDescription,price:r.price,originalPrice:r.originalPrice,discount:r.discount,unit:r.unit,stockCount:r.stockCount,stockStatus:r.stockStatus,isActive:r.isActive,isFeatured:r.isFeatured,isBestSeller:r.isBestSeller,isOrganic:r.isOrganic,isNew:r.isNew,categoryId:r.categoryId,tags:r.tags},include:{category:!0,images:!0,nutrition:!0}});return u.Z.json(s)}catch(e){return console.error("Product update error:",e),u.Z.json({error:"Failed to update product"},{status:500})}}async function l(e,{params:t}){try{return await n.Z.product.delete({where:{slug:t.slug}}),u.Z.json({message:"Product deleted successfully"})}catch(e){return console.error("Product deletion error:",e),u.Z.json({error:"Failed to delete product"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/products/[slug]/route",pathname:"/api/products/[slug]",filename:"route",bundlePath:"app/api/products/[slug]/route"},resolvedPagePath:"c:\\Users\\basan\\Desktop\\karim123\\KarimTraders\\src\\app\\api\\products\\[slug]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:m,headerHooks:w,staticGenerationBailout:v}=p,y="/api/products/[slug]/route";function P(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},34490:(e,t,r)=>{r.d(t,{Z:()=>i,_:()=>o});var s=r(53524);let o=globalThis.prisma??new s.PrismaClient({log:["error"]}),i=o}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1638,6206],()=>r(70924));module.exports=s})();