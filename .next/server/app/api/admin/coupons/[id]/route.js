"use strict";(()=>{var e={};e.id=4455,e.ids=[4455],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},26245:(e,r,o)=>{o.r(r),o.d(r,{headerHooks:()=>x,originalPathname:()=>Z,patchFetch:()=>q,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>y});var t={};o.r(t),o.d(t,{DELETE:()=>w,GET:()=>p,PUT:()=>m});var i=o(95419),a=o(69108),s=o(99678),n=o(78070),u=o(81355),d=o(82002),c=o(34490);async function l(e){return e?.user?.role==="ADMIN"||e?.user?.role==="SUPER_ADMIN"}async function p(e,{params:r}){try{let e=await (0,u.getServerSession)(d.L);if(!await l(e))return n.Z.json({error:"Unauthorized"},{status:403});let{id:o}=await r,t=await c.Z.coupon.findUnique({where:{id:o},include:{_count:{select:{orders:!0}}}});if(!t)return n.Z.json({error:"Coupon not found"},{status:404});return n.Z.json(t)}catch(e){return console.error("Coupon fetch error:",e),n.Z.json({error:"Failed to fetch coupon"},{status:500})}}async function m(e,{params:r}){try{let o=await (0,u.getServerSession)(d.L);if(!await l(o))return n.Z.json({error:"Unauthorized"},{status:403});let{id:t}=await r,i=await e.json(),a=await c.Z.coupon.findUnique({where:{id:t}});if(!a)return n.Z.json({error:"Coupon not found"},{status:404});if(i.code&&i.code.toUpperCase()!==a.code&&await c.Z.coupon.findUnique({where:{code:i.code.toUpperCase()}}))return n.Z.json({error:"Coupon code already exists"},{status:400});let s={};void 0!==i.code&&(s.code=i.code.toUpperCase()),void 0!==i.description&&(s.description=i.description),void 0!==i.type&&(s.type=i.type),void 0!==i.value&&(s.value=parseFloat(i.value)),void 0!==i.minOrderAmount&&(s.minOrderAmount=i.minOrderAmount?parseFloat(i.minOrderAmount):null),void 0!==i.maxDiscount&&(s.maxDiscount=i.maxDiscount?parseFloat(i.maxDiscount):null),void 0!==i.usageLimit&&(s.usageLimit=i.usageLimit?parseInt(i.usageLimit):null),void 0!==i.perUserLimit&&(s.perUserLimit=parseInt(i.perUserLimit)),void 0!==i.validFrom&&(s.validFrom=new Date(i.validFrom)),void 0!==i.validUntil&&(s.validUntil=new Date(i.validUntil)),void 0!==i.isActive&&(s.isActive=i.isActive);let p=await c.Z.coupon.update({where:{id:t},data:s});return n.Z.json(p)}catch(e){return console.error("Coupon update error:",e),n.Z.json({error:"Failed to update coupon"},{status:500})}}async function w(e,{params:r}){try{let e=await (0,u.getServerSession)(d.L);if(!await l(e))return n.Z.json({error:"Unauthorized"},{status:403});let{id:o}=await r;if(await c.Z.order.count({where:{couponId:o}})>0)return await c.Z.coupon.update({where:{id:o},data:{isActive:!1}}),n.Z.json({success:!0,message:"Coupon deactivated (has order history)"});return await c.Z.coupon.delete({where:{id:o}}),n.Z.json({success:!0})}catch(e){return console.error("Coupon deletion error:",e),n.Z.json({error:"Failed to delete coupon"},{status:500})}}let h=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/coupons/[id]/route",pathname:"/api/admin/coupons/[id]",filename:"route",bundlePath:"app/api/admin/coupons/[id]/route"},resolvedPagePath:"c:\\Users\\basan\\Desktop\\karim123\\KarimTraders\\src\\app\\api\\admin\\coupons\\[id]\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:g,staticGenerationAsyncStorage:v,serverHooks:f,headerHooks:x,staticGenerationBailout:y}=h,Z="/api/admin/coupons/[id]/route";function q(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:v})}},82002:(e,r,o)=>{o.d(r,{L:()=>u});var t=o(65822),i=o(86485),a=o(10375),s=o(7529),n=o(34490);let u={adapter:(0,t.N)(n.Z),providers:[(0,a.Z)({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||""}),(0,i.Z)({name:"credentials",credentials:{identifier:{label:"Email or Phone",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){let r;if(!e?.identifier||!e?.password)throw console.log("Missing credentials"),Error("Please enter your email/phone and password");let o=e.identifier.trim();console.log("Login attempt with identifier:",o);let t=o.includes("@");if(console.log("Is email:",t),t)r=await n.Z.user.findUnique({where:{email:o}});else{let e=o.replace(/\s+/g,"").replace(/^\+91/,"").replace(/^91/,"");console.log("Looking for phone:",e),r=await n.Z.user.findFirst({where:{OR:[{phone:o},{phone:e},{phone:`+91${e}`},{phone:`91${e}`}]}})}if(console.log("User found:",r?"Yes":"No"),!r||!r.password)throw Error("No account found with this email/phone");if(!await s.ZP.compare(e.password,r.password))throw console.log("Password invalid for user:",r.email),Error("Incorrect password");if(!r.isActive)throw Error("Your account has been disabled");return console.log("Login successful for:",r.email),{id:r.id,email:r.email,name:r.name,image:r.image,role:r.role}}})],session:{strategy:"jwt",maxAge:2592e3},callbacks:{jwt:async({token:e,user:r,trigger:o,session:t})=>(r&&(e.id=r.id,e.role=r.role),"update"===o&&t&&(e.name=t.name,e.image=t.image),e),session:async({session:e,token:r})=>(e.user&&(e.user.id=r.id,e.user.role=r.role),e)},pages:{signIn:"/login",error:"/login"},events:{async createUser({user:e}){await n.Z.wallet.create({data:{userId:e.id,balance:100}}),await n.Z.notification.create({data:{userId:e.id,type:"SYSTEM",title:"Welcome to KARIM TRADERS!",message:"Your account has been created successfully. Enjoy â‚¹100 welcome bonus in your wallet!"}})}},debug:!1}},34490:(e,r,o)=>{o.d(r,{Z:()=>a,_:()=>i});var t=o(53524);let i=globalThis.prisma??new t.PrismaClient({log:["error"]}),a=i}};var r=require("../../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[1638,6206,7529,244],()=>o(26245));module.exports=t})();