"use strict";(()=>{var e={};e.id=5501,e.ids=[5501],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},74546:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>y,originalPathname:()=>b,patchFetch:()=>x,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>f});var a={};r.r(a),r.d(a,{GET:()=>p});var o=r(95419),s=r(69108),i=r(99678),n=r(78070),d=r(81355),u=r(82002),c=r(34490);async function l(e){return e?.user?.role==="ADMIN"||e?.user?.role==="SUPER_ADMIN"}async function p(e){try{let t=await (0,d.getServerSession)(u.L);if(!await l(t))return n.Z.json({error:"Unauthorized"},{status:403});let{searchParams:r}=new URL(e.url),a=r.get("period")||"7d",o=new Date;switch(a){case"24h":o.setHours(o.getHours()-24);break;case"7d":default:o.setDate(o.getDate()-7);break;case"30d":o.setDate(o.getDate()-30);break;case"90d":o.setDate(o.getDate()-90)}let[s,i,p,m,g,h,w,y,f,b,x]=await Promise.all([c.Z.order.count({where:{createdAt:{gte:o}}}),c.Z.order.aggregate({where:{createdAt:{gte:o},paymentStatus:"PAID"},_sum:{total:!0}}),c.Z.user.count(),c.Z.product.count({where:{isActive:!0}}),c.Z.order.findMany({include:{user:{select:{name:!0,email:!0}},items:{take:3,include:{product:{select:{name:!0}}}}},orderBy:{createdAt:"desc"},take:10}),c.Z.order.groupBy({by:["status"],where:{createdAt:{gte:o}},_count:!0}),c.Z.orderItem.groupBy({by:["productId"],where:{order:{createdAt:{gte:o},status:{not:"CANCELLED"}}},_sum:{quantity:!0},orderBy:{_sum:{quantity:"desc"}},take:10}),c.Z.product.findMany({where:{isActive:!0,stockCount:{lte:10}},select:{id:!0,name:!0,stockCount:!0,stockStatus:!0},orderBy:{stockCount:"asc"},take:10}),c.Z.order.findMany({where:{createdAt:{gte:o},paymentStatus:"PAID"},select:{createdAt:!0,total:!0},orderBy:{createdAt:"asc"}}),c.Z.user.count({where:{createdAt:{gte:o}}}),c.Z.order.count({where:{status:"PENDING"}})]),A=new Map;f.forEach(e=>{let t=e.createdAt.toISOString().split("T")[0],r=A.get(t)||0;A.set(t,r+Number(e.total))});let Z=Array.from(A.entries()).map(([e,t])=>({date:e,revenue:t})),v=w.map(e=>e.productId),q=await c.Z.product.findMany({where:{id:{in:v}},select:{id:!0,name:!0,price:!0}}),D=w.map(e=>({...q.find(t=>t.id===e.productId),totalSold:e._sum.quantity})),E=new Date(o);E.setDate(E.getDate()-("24h"===a?1:"7d"===a?7:30));let[I,P]=await Promise.all([c.Z.order.count({where:{createdAt:{gte:E,lt:o}}}),c.Z.order.aggregate({where:{createdAt:{gte:E,lt:o},paymentStatus:"PAID"},_sum:{total:!0}})]),_=I>0?((s-I)/I*100).toFixed(1):100,k=P._sum.total&&Number(P._sum.total)>0?(((Number(i._sum.total)||0)-Number(P._sum.total))/Number(P._sum.total)*100).toFixed(1):100;return n.Z.json({overview:{totalOrders:s,totalRevenue:Number(i._sum.total)||0,totalUsers:p,totalProducts:m,newUsers:b,pendingOrders:x,orderGrowth:Number(_),revenueGrowth:Number(k)},recentOrders:g,ordersByStatus:Object.fromEntries(h.map(e=>[e.status,e._count])),topProducts:D,lowStockProducts:y,revenueByDay:Z})}catch(e){return console.error("Dashboard stats error:",e),n.Z.json({error:"Failed to fetch dashboard stats"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/dashboard/route",pathname:"/api/admin/dashboard",filename:"route",bundlePath:"app/api/admin/dashboard/route"},resolvedPagePath:"c:\\Users\\basan\\Desktop\\karim123\\KarimTraders\\src\\app\\api\\admin\\dashboard\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:w,headerHooks:y,staticGenerationBailout:f}=m,b="/api/admin/dashboard/route";function x(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}},82002:(e,t,r)=>{r.d(t,{L:()=>d});var a=r(65822),o=r(86485),s=r(10375),i=r(7529),n=r(34490);let d={adapter:(0,a.N)(n.Z),providers:[(0,s.Z)({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||""}),(0,o.Z)({name:"credentials",credentials:{identifier:{label:"Email or Phone",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){let t;if(!e?.identifier||!e?.password)throw console.log("Missing credentials"),Error("Please enter your email/phone and password");let r=e.identifier.trim();console.log("Login attempt with identifier:",r);let a=r.includes("@");if(console.log("Is email:",a),a)t=await n.Z.user.findUnique({where:{email:r}});else{let e=r.replace(/\s+/g,"").replace(/^\+91/,"").replace(/^91/,"");console.log("Looking for phone:",e),t=await n.Z.user.findFirst({where:{OR:[{phone:r},{phone:e},{phone:`+91${e}`},{phone:`91${e}`}]}})}if(console.log("User found:",t?"Yes":"No"),!t||!t.password)throw Error("No account found with this email/phone");if(!await i.ZP.compare(e.password,t.password))throw console.log("Password invalid for user:",t.email),Error("Incorrect password");if(!t.isActive)throw Error("Your account has been disabled");return console.log("Login successful for:",t.email),{id:t.id,email:t.email,name:t.name,image:t.image,role:t.role}}})],session:{strategy:"jwt",maxAge:2592e3},callbacks:{jwt:async({token:e,user:t,trigger:r,session:a})=>(t&&(e.id=t.id,e.role=t.role),"update"===r&&a&&(e.name=a.name,e.image=a.image),e),session:async({session:e,token:t})=>(e.user&&(e.user.id=t.id,e.user.role=t.role),e)},pages:{signIn:"/login",error:"/login"},events:{async createUser({user:e}){await n.Z.wallet.create({data:{userId:e.id,balance:100}}),await n.Z.notification.create({data:{userId:e.id,type:"SYSTEM",title:"Welcome to KARIM TRADERS!",message:"Your account has been created successfully. Enjoy â‚¹100 welcome bonus in your wallet!"}})}},debug:!1}},34490:(e,t,r)=>{r.d(t,{Z:()=>s,_:()=>o});var a=r(53524);let o=globalThis.prisma??new a.PrismaClient({log:["error"]}),s=o}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,7529,244],()=>r(74546));module.exports=a})();