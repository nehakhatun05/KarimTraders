"use strict";(()=>{var e={};e.id=7777,e.ids=[7777],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},82661:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>y,originalPathname:()=>v,patchFetch:()=>q,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>f});var a={};r.r(a),r.d(a,{GET:()=>p});var n=r(95419),s=r(69108),o=r(99678),i=r(78070),l=r(81355),c=r(82002),u=r(34490);async function d(e){return e?.user?.role==="ADMIN"||e?.user?.role==="SUPER_ADMIN"}async function p(e){try{let t=await (0,l.getServerSession)(c.L);if(!await d(t))return i.Z.json({error:"Unauthorized"},{status:403});let{searchParams:r}=new URL(e.url),a=r.get("period")||"30d",n=new Date,s=30;switch(a){case"7d":s=7,n.setDate(n.getDate()-7);break;case"30d":default:s=30,n.setDate(n.getDate()-30);break;case"90d":s=90,n.setDate(n.getDate()-90);break;case"365d":s=365,n.setDate(n.getDate()-365)}let o=await u.Z.order.findMany({where:{createdAt:{gte:n}},select:{id:!0,total:!0,status:!0,paymentMethod:!0,createdAt:!0,items:{select:{quantity:!0,price:!0,productId:!0,product:{select:{name:!0,categoryId:!0}}}}}}),p=[],m=new Map;o.forEach(e=>{let t=new Date(e.createdAt).toISOString().split("T")[0],r=m.get(t)||{revenue:0,orders:0};m.set(t,{revenue:r.revenue+e.total,orders:r.orders+1})});for(let e=0;e<s;e++){let t=new Date;t.setDate(t.getDate()-e);let r=t.toISOString().split("T")[0],a=m.get(r)||{revenue:0,orders:0};p.unshift({date:r,...a})}let g={};o.forEach(e=>{g[e.status]=(g[e.status]||0)+1});let h=Object.entries(g).map(([e,t])=>({status:e,count:t})),w={};o.forEach(e=>{let t=e.paymentMethod||"Unknown";w[t]=(w[t]||0)+1});let y=Object.entries(w).map(([e,t])=>({method:e,count:t})),f={};o.forEach(e=>{e.items.forEach(e=>{let t=e.productId,r=f[t]||{name:e.product?.name||"Unknown",quantity:0,revenue:0};f[t]={name:r.name,quantity:r.quantity+e.quantity,revenue:r.revenue+e.price*e.quantity}})});let v=Object.entries(f).map(([e,t])=>({id:e,...t})).sort((e,t)=>t.revenue-e.revenue).slice(0,10),q=await u.Z.category.findMany({select:{id:!0,name:!0}}),x=new Map(q.map(e=>[e.id,e.name])),E={};o.forEach(e=>{e.items.forEach(e=>{let t=e.product?.categoryId;if(t){let r=E[t]||{name:x.get(t)||"Unknown",quantity:0,revenue:0};E[t]={name:r.name,quantity:r.quantity+e.quantity,revenue:r.revenue+e.price*e.quantity}}})});let b=Object.entries(E).map(([e,t])=>({id:e,...t})).sort((e,t)=>t.revenue-e.revenue),D=o.reduce((e,t)=>e+t.total,0),I=o.length,A=new Date(n);A.setDate(A.getDate()-s);let Z=await u.Z.order.findMany({where:{createdAt:{gte:A,lt:n}},select:{total:!0}}),M=Z.reduce((e,t)=>e+t.total,0),O=Z.length,S=await u.Z.user.count({where:{createdAt:{gte:n},role:"CUSTOMER"}}),j=await u.Z.user.count({where:{createdAt:{gte:A,lt:n},role:"CUSTOMER"}});return i.Z.json({period:a,summary:{totalRevenue:D,totalOrders:I,avgOrderValue:I>0?D/I:0,newCustomers:S,revenueGrowth:M>0?(D-M)/M*100:D>0?100:0,ordersGrowth:O>0?(I-O)/O*100:I>0?100:0,customerGrowth:j>0?(S-j)/j*100:S>0?100:0},dailyRevenue:p,ordersByStatus:h,ordersByPayment:y,topProducts:v,categoryPerformance:b})}catch(e){return console.error("Analytics fetch error:",e),i.Z.json({error:"Failed to fetch analytics"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/analytics/route",pathname:"/api/admin/analytics",filename:"route",bundlePath:"app/api/admin/analytics/route"},resolvedPagePath:"C:\\Users\\basan\\Desktop\\karim123\\KarimTraders\\src\\app\\api\\admin\\analytics\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:w,headerHooks:y,staticGenerationBailout:f}=m,v="/api/admin/analytics/route";function q(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}},82002:(e,t,r)=>{r.d(t,{L:()=>l});var a=r(65822),n=r(86485),s=r(10375),o=r(7529),i=r(34490);let l={adapter:(0,a.N)(i.Z),providers:[(0,s.Z)({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||""}),(0,n.Z)({name:"credentials",credentials:{identifier:{label:"Email or Phone",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){let t;if(!e?.identifier||!e?.password)throw console.log("Missing credentials"),Error("Please enter your email/phone and password");let r=e.identifier.trim();console.log("Login attempt with identifier:",r);let a=r.includes("@");if(console.log("Is email:",a),a)t=await i.Z.user.findUnique({where:{email:r}});else{let e=r.replace(/\s+/g,"").replace(/^\+91/,"").replace(/^91/,"");console.log("Looking for phone:",e),t=await i.Z.user.findFirst({where:{OR:[{phone:r},{phone:e},{phone:`+91${e}`},{phone:`91${e}`}]}})}if(console.log("User found:",t?"Yes":"No"),!t||!t.password)throw Error("No account found with this email/phone");if(!await o.ZP.compare(e.password,t.password))throw console.log("Password invalid for user:",t.email),Error("Incorrect password");if(!t.isActive)throw Error("Your account has been disabled");return console.log("Login successful for:",t.email),{id:t.id,email:t.email,name:t.name,image:t.image,role:t.role}}})],session:{strategy:"jwt",maxAge:2592e3},callbacks:{jwt:async({token:e,user:t,trigger:r,session:a})=>(t&&(e.id=t.id,e.role=t.role),"update"===r&&a&&(e.name=a.name,e.image=a.image),e),session:async({session:e,token:t})=>(e.user&&(e.user.id=t.id,e.user.role=t.role),e)},pages:{signIn:"/login",error:"/login"},events:{async createUser({user:e}){await i.Z.wallet.create({data:{userId:e.id,balance:100}}),await i.Z.notification.create({data:{userId:e.id,type:"SYSTEM",title:"Welcome to KARIM TRADERS!",message:"Your account has been created successfully. Enjoy â‚¹100 welcome bonus in your wallet!"}})}},debug:!1}},34490:(e,t,r)=>{r.d(t,{Z:()=>s,_:()=>n});var a=r(53524);let n=globalThis.prisma??new a.PrismaClient({log:["error"]}),s=n}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,7529,244],()=>r(82661));module.exports=a})();