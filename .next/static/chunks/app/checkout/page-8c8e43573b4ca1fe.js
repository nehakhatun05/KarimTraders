(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{9057:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]])},2442:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},6141:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},1738:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},7480:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]])},6264:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},6142:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},4822:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]])},2549:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},3271:function(e,t,s){Promise.resolve().then(s.bind(s,3079))},3079:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var a=s(7437),r=s(2265),i=s(4033),n=s(1396),d=s.n(n),l=s(2749),c=s(6142),o=s(6141),m=s(1738),u=s(2442),p=s(6264),h=s(7480),x=s(9057);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let y=(0,s(2898).Z)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);var f=s(9883),g=s(4822),b=s(2549),v=s(7039),j=s(5925);function N(){var e,t,s,n,N,w;let k=(0,i.useRouter)(),{data:C,status:S}=(0,l.useSession)(),{items:P,getSubtotal:Z,clearCart:O}=(0,v.xS)(),[D,A]=(0,r.useState)("address"),[M,I]=(0,r.useState)([]),[E,z]=(0,r.useState)([]),[T,L]=(0,r.useState)(null),[F,q]=(0,r.useState)(""),[R,_]=(0,r.useState)(""),[J,B]=(0,r.useState)("COD"),[U,H]=(0,r.useState)(!1),[W,Q]=(0,r.useState)(!0),[K,V]=(0,r.useState)(""),[Y,X]=(0,r.useState)(null),[G,$]=(0,r.useState)(0),[ee,et]=(0,r.useState)(""),[es,ea]=(0,r.useState)(!1),[er,ei]=(0,r.useState)({type:"HOME",name:"",phone:"",addressLine1:"",addressLine2:"",city:"",state:"",pincode:"",landmark:""}),[en,ed]=(0,r.useState)(!1),[el,ec]=(0,r.useState)(!1),[eo,em]=(0,r.useState)({checking:!1,isServiceable:null,serviceArea:null}),eu=async e=>{em({checking:!0,isServiceable:null,serviceArea:null});try{let t=await fetch("/api/service-areas?pincode=".concat(e)),s=await t.json();return em({checking:!1,isServiceable:s.isServiceable,serviceArea:s.serviceArea,error:s.isServiceable?void 0:"Sorry, we do not deliver to this area yet."}),s.isServiceable}catch(e){return em({checking:!1,isServiceable:!1,serviceArea:null,error:"Failed to check service area."}),!1}};(0,r.useEffect)(()=>{let e=document.createElement("script");return e.src="https://checkout.razorpay.com/v1/checkout.js",e.async=!0,e.onload=()=>ec(!0),document.body.appendChild(e),()=>{document.body.removeChild(e)}},[]);let ep=[{id:"address",label:"Address",icon:c.Z},{id:"delivery",label:"Delivery",icon:o.Z},{id:"payment",label:"Payment",icon:m.Z},{id:"review",label:"Review",icon:u.Z}];(0,r.useEffect)(()=>{"unauthenticated"===S&&k.push("/login?callbackUrl=/checkout")},[S,k]),(0,r.useEffect)(()=>{"authenticated"===S&&eh()},[S]);let eh=async()=>{Q(!0);try{let[e,t,s]=await Promise.all([fetch("/api/user/addresses"),fetch("/api/user/wallet"),fetch("/api/delivery-slots")]);if(e.ok){let t=await e.json();I(t);let s=t.find(e=>e.isDefault);s?(q(s.id),eu(s.pincode)):t.length>0&&(q(t[0].id),eu(t[0].pincode))}if(t.ok){let e=await t.json();L(e)}if(s.ok){let e=await s.json();z(e.filter(e=>e.isActive)),e.length>0&&_(e[0].id)}}catch(e){console.error("Error fetching user data:",e),j.ZP.error("Failed to load checkout data")}finally{Q(!1)}},ex=Z(),ey=ex>=499?0:29,ef=ex-G+ey;if("loading"===S||W)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)(p.Z,{className:"w-8 h-8 animate-spin text-primary-600"})});if(0===P.length)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Your cart is empty"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Add items to your cart to proceed with checkout"}),(0,a.jsx)(d(),{href:"/products",className:"btn-primary",children:"Continue Shopping"})]})});let eg=async()=>{if(K.trim()){try{let e=await fetch("/api/coupons/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:K,subtotal:ex})});if(e.ok){let t=await e.json();$(t.discount),X(K.toUpperCase()),j.ZP.success("Coupon applied! You save ₹".concat(t.discount))}else{let t=await e.json();j.ZP.error(t.error||"Invalid coupon code")}}catch(e){j.ZP.error("Failed to apply coupon")}V("")}},eb=async()=>{if(!er.name||!er.phone||!er.addressLine1||!er.city||!er.state||!er.pincode){j.ZP.error("Please fill all required fields");return}ed(!0);try{let e=await fetch("/api/user/addresses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(er)});if(e.ok){let t=await e.json();I([...M,t]),q(t.id),await eu(t.pincode),ea(!1),ei({type:"HOME",name:"",phone:"",addressLine1:"",addressLine2:"",city:"",state:"",pincode:"",landmark:""}),j.ZP.success("Address saved successfully")}else{let t=await e.json();j.ZP.error(t.error||"Failed to save address")}}catch(e){j.ZP.error("Failed to save address")}finally{ed(!1)}},ev=async()=>{try{for(let e of(await fetch("/api/cart",{method:"DELETE"}),P))await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:e.product.id,quantity:e.quantity})});return!0}catch(e){return console.error("Error syncing cart:",e),!1}},ej=async()=>{if(!F){j.ZP.error("Please select a delivery address"),A("address");return}if(!1===eo.isServiceable){j.ZP.error("We do not deliver to the selected address area. Please choose a different address."),A("address");return}if(null===eo.isServiceable){let e=M.find(e=>e.id===F);if(e&&!await eu(e.pincode)){j.ZP.error("We do not deliver to the selected address area. Please choose a different address."),A("address");return}}H(!0);try{if(!await ev()){j.ZP.error("Failed to sync cart. Please try again."),H(!1);return}if("online"===J){if(!el){j.ZP.error("Payment system loading. Please try again."),H(!1);return}let e=await fetch("/api/orders/online",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({addressId:F,deliverySlotId:R||void 0,notes:ee||void 0,couponCode:Y||void 0})});if(!e.ok){let t=await e.json();j.ZP.error(t.error||"Failed to create order"),H(!1);return}let t=await e.json(),s={key:t.razorpay.key,amount:t.razorpay.amount,currency:t.razorpay.currency,name:t.razorpay.name,description:t.razorpay.description,order_id:t.razorpay.orderId,prefill:t.razorpay.prefill,notes:t.razorpay.notes,theme:t.razorpay.theme,handler:async function(e){try{let s=await fetch("/api/payments/razorpay/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_order_id:e.razorpay_order_id,razorpay_payment_id:e.razorpay_payment_id,razorpay_signature:e.razorpay_signature,orderId:t.orderId})});if(s.ok)O(),j.ZP.success("Payment successful! Order placed."),k.push("/order-success?orderId=".concat(t.orderNumber));else{let e=await s.json();j.ZP.error(e.error||"Payment verification failed")}}catch(e){j.ZP.error("Payment verification failed. Contact support.")}},modal:{ondismiss:async function(){await fetch("/api/orders/online?orderId=".concat(t.orderId),{method:"DELETE"}),H(!1),j.ZP.error("Payment cancelled")}}},a=new window.Razorpay(s);a.on("payment.failed",async function(e){await fetch("/api/orders/online?orderId=".concat(t.orderId),{method:"DELETE"}),j.ZP.error("Payment failed: ".concat(e.error.description)),H(!1)}),a.open();return}let e=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({addressId:F,paymentMethod:"cod"===J?"COD":"wallet"===J?"WALLET":"ONLINE",deliverySlotId:R||void 0,notes:ee||void 0,couponCode:Y||void 0})});if(e.ok){let t=await e.json();O(),j.ZP.success("Order placed successfully!"),k.push("/order-success?orderId=".concat(t.orderNumber))}else{let t=await e.json();j.ZP.error(t.error||"Failed to place order")}}catch(e){console.error("Order error:",e),j.ZP.error("Something went wrong. Please try again.")}finally{H(!1)}},eN=e=>{switch(null==e?void 0:e.toLowerCase()){case"home":return h.Z;case"work":return x.Z;default:return y}};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white border-b sticky top-0 z-40",children:(0,a.jsx)("div",{className:"container-custom py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(d(),{href:"/",className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-primary-600 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-bold text-xl",children:"K"})}),(0,a.jsx)("span",{className:"font-display font-bold text-xl text-gray-800",children:"KARIM TRADERS"})]}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Secure Checkout \uD83D\uDD12"})]})})}),(0,a.jsxs)("div",{className:"container-custom py-8",children:[(0,a.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-4 mb-6",children:(0,a.jsx)("div",{className:"flex items-center justify-between max-w-2xl mx-auto",children:ep.map((e,t)=>{let s=e.icon,r=ep.findIndex(e=>e.id===D),i=ep.findIndex(t=>t.id===e.id)<r,n=e.id===D;return(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(i?"bg-primary-600 text-white":n?"bg-primary-600 text-white":"bg-gray-200 text-gray-500"),children:i?(0,a.jsx)(u.Z,{size:20}):(0,a.jsx)(s,{size:20})}),(0,a.jsx)("span",{className:"text-xs mt-1 ".concat(n?"text-primary-600 font-medium":"text-gray-500"),children:e.label})]}),t<ep.length-1&&(0,a.jsx)("div",{className:"w-12 sm:w-16 md:w-24 h-1 mx-2 rounded ".concat(i?"bg-primary-600":"bg-gray-200")})]},e.id)})})}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:["address"===D&&(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-6",children:"Select Delivery Address"}),0===M.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(c.Z,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"No saved addresses found"}),(0,a.jsxs)("button",{onClick:()=>ea(!0),className:"btn-primary",children:[(0,a.jsx)(f.Z,{size:18,className:"mr-2"}),"Add New Address"]})]}):(0,a.jsx)("div",{className:"space-y-4",children:M.map(e=>{var t;let s=eN(e.type);return(0,a.jsx)("label",{className:"block p-4 border-2 rounded-lg cursor-pointer transition-colors ".concat(F===e.id?"border-primary-600 bg-primary-50":"border-gray-200 hover:border-gray-300"),children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("input",{type:"radio",name:"address",value:e.id,checked:F===e.id,onChange:()=>q(e.id),className:"mt-1"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(s,{size:16,className:"text-gray-500"}),(0,a.jsx)("span",{className:"font-medium capitalize",children:null===(t=e.type)||void 0===t?void 0:t.toLowerCase()}),e.isDefault&&(0,a.jsx)("span",{className:"text-xs bg-primary-100 text-primary-700 px-2 py-0.5 rounded",children:"Default"})]}),(0,a.jsx)("p",{className:"font-medium text-gray-800",children:e.name}),(0,a.jsxs)("p",{className:"text-gray-600 text-sm",children:[e.addressLine1,e.addressLine2&&", ".concat(e.addressLine2)]}),(0,a.jsxs)("p",{className:"text-gray-600 text-sm",children:[e.city,", ",e.state," - ",e.pincode]}),(0,a.jsxs)("p",{className:"text-gray-600 text-sm mt-1",children:["Phone: ",e.phone]})]})]})},e.id)})}),(0,a.jsxs)("button",{onClick:()=>ea(!0),className:"mt-4 flex items-center gap-2 text-primary-600 font-medium hover:text-primary-700",children:[(0,a.jsx)(f.Z,{size:18}),"Add New Address"]}),(0,a.jsx)("button",{onClick:()=>A("delivery"),className:"w-full btn-primary mt-6",disabled:!F,children:"Continue to Delivery"})]}),"delivery"===D&&(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-6",children:"Select Delivery Slot"}),0===E.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(o.Z,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Standard delivery will be applied"})]}):(0,a.jsx)("div",{className:"space-y-3",children:E.map(e=>(0,a.jsx)("label",{className:"block p-4 border-2 rounded-lg cursor-pointer transition-colors ".concat(R===e.id?"border-primary-600 bg-primary-50":"border-gray-200 hover:border-gray-300"),children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("input",{type:"radio",name:"slot",value:e.id,checked:R===e.id,onChange:()=>_(e.id)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-800",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[e.startTime," - ",e.endTime]})]})]})},e.id))}),(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Order Notes (Optional)"}),(0,a.jsx)("textarea",{value:ee,onChange:e=>et(e.target.value),placeholder:"Any special instructions for delivery...",className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",rows:3})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,a.jsx)("button",{onClick:()=>A("address"),className:"btn-outline",children:"Back"}),(0,a.jsx)("button",{onClick:()=>A("payment"),className:"flex-1 btn-primary",children:"Continue to Payment"})]})]}),"payment"===D&&(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-6",children:"Select Payment Method"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("label",{className:"block p-4 border-2 rounded-lg cursor-pointer transition-colors ".concat("cod"===J?"border-primary-600 bg-primary-50":"border-gray-200 hover:border-gray-300"),children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("input",{type:"radio",name:"payment",value:"cod",checked:"cod"===J,onChange:()=>B("cod")}),(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCB5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-800",children:"Cash on Delivery"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Pay when you receive"})]})]})}),T&&T.balance>0&&(0,a.jsx)("label",{className:"block p-4 border-2 rounded-lg cursor-pointer transition-colors ".concat("wallet"===J?"border-primary-600 bg-primary-50":T.balance<ef?"border-gray-200 opacity-50 cursor-not-allowed":"border-gray-200 hover:border-gray-300"),children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("input",{type:"radio",name:"payment",value:"wallet",checked:"wallet"===J,onChange:()=>B("wallet"),disabled:T.balance<ef}),(0,a.jsx)(g.Z,{className:"w-6 h-6 text-primary-600"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-800",children:"Pay from Wallet"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Balance: ₹",T.balance]})]}),T.balance<ef&&(0,a.jsx)("span",{className:"text-xs text-red-500",children:"Insufficient balance"})]})}),(0,a.jsx)("label",{className:"block p-4 border-2 rounded-lg cursor-pointer transition-colors ".concat("online"===J?"border-primary-600 bg-primary-50":"border-gray-200 hover:border-gray-300"),children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("input",{type:"radio",name:"payment",value:"online",checked:"online"===J,onChange:()=>B("online")}),(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCB3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-800",children:"Pay Online"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"UPI, Cards, Net Banking"})]})]})})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,a.jsx)("button",{onClick:()=>A("delivery"),className:"btn-outline",children:"Back"}),(0,a.jsx)("button",{onClick:()=>A("review"),className:"flex-1 btn-primary",children:"Review Order"})]})]}),"review"===D&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Order Items"}),(0,a.jsx)("div",{className:"space-y-4",children:P.map(e=>{var t;return(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-lg overflow-hidden",children:(0,a.jsx)("img",{src:(null===(t=e.product.images)||void 0===t?void 0:t[0])||"https://via.placeholder.com/100",alt:e.product.name,className:"w-full h-full object-cover"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-800",children:e.product.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Qty: ",e.quantity," \xd7 ₹",e.product.price]})]}),(0,a.jsxs)("p",{className:"font-medium",children:["₹",(e.product.price*e.quantity).toFixed(2)]})]},e.product.id)})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Delivery Address"}),(0,a.jsx)("button",{onClick:()=>A("address"),className:"text-primary-600 text-sm font-medium",children:"Change"})]}),M.find(e=>e.id===F)&&(0,a.jsxs)("div",{className:"text-gray-600",children:[(0,a.jsx)("p",{className:"font-medium text-gray-800",children:null===(e=M.find(e=>e.id===F))||void 0===e?void 0:e.name}),(0,a.jsx)("p",{children:null===(t=M.find(e=>e.id===F))||void 0===t?void 0:t.addressLine1}),(0,a.jsxs)("p",{children:[null===(s=M.find(e=>e.id===F))||void 0===s?void 0:s.city,","," ",null===(n=M.find(e=>e.id===F))||void 0===n?void 0:n.state," -"," ",null===(N=M.find(e=>e.id===F))||void 0===N?void 0:N.pincode]}),(0,a.jsxs)("p",{className:"mt-1",children:["Phone: ",null===(w=M.find(e=>e.id===F))||void 0===w?void 0:w.phone]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Payment Method"}),(0,a.jsx)("button",{onClick:()=>A("payment"),className:"text-primary-600 text-sm font-medium",children:"Change"})]}),(0,a.jsxs)("p",{className:"text-gray-800",children:["cod"===J&&"\uD83D\uDCB5 Cash on Delivery","wallet"===J&&"\uD83D\uDC5B Wallet Payment","online"===J&&"\uD83D\uDCB3 Online Payment"]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>A("payment"),className:"btn-outline",children:"Back"}),(0,a.jsx)("button",{onClick:ej,disabled:U,className:"flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:U?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.Z,{className:"w-5 h-5 animate-spin"}),"Processing..."]}):"Place Order • ₹".concat(ef.toFixed(2))})]})]})]}),(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 sticky top-24",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Order Summary"}),(0,a.jsx)("div",{className:"mb-4",children:Y?(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(u.Z,{className:"w-5 h-5 text-green-600"}),(0,a.jsx)("span",{className:"text-green-700 font-medium",children:Y})]}),(0,a.jsx)("button",{onClick:()=>{X(null),$(0),j.ZP.success("Coupon removed")},className:"text-gray-500 hover:text-gray-700",children:(0,a.jsx)(b.Z,{size:18})})]}):(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:K,onChange:e=>V(e.target.value),placeholder:"Coupon code",className:"flex-1 px-3 py-2 border rounded-lg text-sm"}),(0,a.jsx)("button",{onClick:eg,className:"px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700",children:"Apply"})]})}),(0,a.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{className:"text-gray-600",children:["Subtotal (",P.length," items)"]}),(0,a.jsxs)("span",{children:["₹",ex.toFixed(2)]})]}),G>0&&(0,a.jsxs)("div",{className:"flex justify-between text-green-600",children:[(0,a.jsx)("span",{children:"Coupon Discount"}),(0,a.jsxs)("span",{children:["-₹",G.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Delivery"}),(0,a.jsx)("span",{className:0===ey?"text-green-600":"",children:0===ey?"FREE":"₹".concat(ey)})]}),(0,a.jsx)("div",{className:"border-t pt-3",children:(0,a.jsxs)("div",{className:"flex justify-between text-lg font-semibold",children:[(0,a.jsx)("span",{children:"Total"}),(0,a.jsxs)("span",{className:"text-primary-600",children:["₹",ef.toFixed(2)]})]})})]}),ex<499&&(0,a.jsxs)("p",{className:"mt-4 text-xs text-gray-500 text-center",children:["Add ₹",(499-ex).toFixed(0)," more for FREE delivery"]}),(0,a.jsxs)("div",{className:"mt-6 flex items-center justify-center gap-2 text-gray-500 text-sm",children:[(0,a.jsx)("span",{children:"\uD83D\uDD12"}),(0,a.jsx)("span",{children:"Secure checkout powered by SSL"})]})]})})]})]}),es&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>ea(!1)}),(0,a.jsxs)("div",{className:"relative bg-white rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"sticky top-0 bg-white p-4 border-b flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Add New Address"}),(0,a.jsx)("button",{onClick:()=>ea(!1),children:(0,a.jsx)(b.Z,{size:24})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address Type"}),(0,a.jsx)("div",{className:"flex gap-3",children:["HOME","WORK","OTHER"].map(e=>(0,a.jsx)("button",{onClick:()=>ei({...er,type:e}),className:"px-4 py-2 rounded-lg border ".concat(er.type===e?"border-primary-600 bg-primary-50 text-primary-600":"border-gray-200 hover:border-gray-300"),children:e.charAt(0)+e.slice(1).toLowerCase()},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),(0,a.jsx)("input",{type:"text",value:er.name,onChange:e=>ei({...er,name:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"Enter full name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number *"}),(0,a.jsx)("input",{type:"tel",value:er.phone,onChange:e=>ei({...er,phone:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"Enter phone number"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address Line 1 *"}),(0,a.jsx)("input",{type:"text",value:er.addressLine1,onChange:e=>ei({...er,addressLine1:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"House/Flat no., Building name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address Line 2"}),(0,a.jsx)("input",{type:"text",value:er.addressLine2,onChange:e=>ei({...er,addressLine2:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"Street, Area"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City *"}),(0,a.jsx)("input",{type:"text",value:er.city,onChange:e=>ei({...er,city:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"City"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"State *"}),(0,a.jsx)("input",{type:"text",value:er.state,onChange:e=>ei({...er,state:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"State"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pincode *"}),(0,a.jsx)("input",{type:"text",value:er.pincode,onChange:e=>ei({...er,pincode:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"Pincode"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Landmark"}),(0,a.jsx)("input",{type:"text",value:er.landmark,onChange:e=>ei({...er,landmark:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"Nearby landmark"})]}),(0,a.jsx)("button",{onClick:eb,disabled:en,className:"w-full btn-primary flex items-center justify-center gap-2",children:en?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.Z,{className:"w-5 h-5 animate-spin"}),"Saving..."]}):"Save Address"})]})]})]})]})}},7039:function(e,t,s){"use strict";s.d(t,{HB:function(){return l},Rp:function(){return d},Yl:function(){return n},xS:function(){return i}});var a=s(4660),r=s(4810);let i=(0,a.Ue)()((0,r.tJ)((e,t)=>({items:[],isOpen:!1,isSyncing:!1,setItems:t=>e({items:t}),setSyncing:t=>e({isSyncing:t}),addItem:(t,s)=>{e(e=>e.items.find(e=>e.product.id===t.id)?{items:e.items.map(e=>e.product.id===t.id?{...e,quantity:e.quantity+s}:e)}:{items:[...e.items,{product:t,quantity:s,selectedUnit:t.unit}]})},removeItem:t=>{e(e=>({items:e.items.filter(e=>e.product.id!==t)}))},updateQuantity:(t,s)=>{e(e=>({items:e.items.map(e=>e.product.id===t?{...e,quantity:Math.max(0,s)}:e).filter(e=>e.quantity>0)}))},clearCart:()=>e({items:[]}),toggleCart:()=>e(e=>({isOpen:!e.isOpen})),getSubtotal:()=>t().items.reduce((e,t)=>e+t.product.price*t.quantity,0),getItemCount:()=>t().items.reduce((e,t)=>e+t.quantity,0),getDeliveryCharge:()=>t().getSubtotal()>=500?0:40,getTotal:()=>t().getSubtotal()+t().getDeliveryCharge(),syncAddItem:async(e,s,a)=>{if(!a)return t().addItem(e,s),!0;try{if((await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:e.id,quantity:s})})).ok)return t().addItem(e,s),!0;return!1}catch(e){return console.error("Sync add item error:",e),!1}},syncUpdateQuantity:async(e,s,a)=>{if(!a)return t().updateQuantity(e,s),!0;try{if((await fetch("/api/cart",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:e,quantity:s})})).ok)return t().updateQuantity(e,s),!0;return!1}catch(e){return console.error("Sync update quantity error:",e),!1}},syncRemoveItem:async(e,s)=>{if(!s)return t().removeItem(e),!0;try{if((await fetch("/api/cart",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:e,quantity:0})})).ok)return t().removeItem(e),!0;return!1}catch(e){return console.error("Sync remove item error:",e),!1}},syncClearCart:async e=>{if(!e)return t().clearCart(),!0;try{if((await fetch("/api/cart",{method:"DELETE"})).ok)return t().clearCart(),!0;return!1}catch(e){return console.error("Sync clear cart error:",e),!1}},loadFromDatabase:async s=>{if(s){e({isSyncing:!0});try{let s=await fetch("/api/cart");if(s.ok){let a=((await s.json()).items||[]).map(e=>{var t,s;return{product:{id:e.product.id,name:e.product.name,slug:e.product.slug,price:Number(e.product.price),originalPrice:e.product.originalPrice?Number(e.product.originalPrice):Number(e.product.price),discount:e.product.discount||0,unit:e.product.unit,images:(null===(t=e.product.images)||void 0===t?void 0:t.map(e=>e.url))||[],category:(null===(s=e.product.category)||void 0===s?void 0:s.name)||"",stockCount:e.product.stockCount,stockStatus:e.product.stockStatus,rating:e.product.rating||0,reviewCount:e.product.reviewCount||0},quantity:e.quantity,selectedUnit:e.product.unit}}),r=t().items,i=new Map;for(let e of(a.forEach(e=>{i.set(e.product.id,e)}),r))i.has(e.product.id)||(i.set(e.product.id,e),await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:e.product.id,quantity:e.quantity})}));e({items:Array.from(i.values())})}}catch(e){console.error("Load from database error:",e)}finally{e({isSyncing:!1})}}}}),{name:"karim-cart"})),n=(0,a.Ue)()((0,r.tJ)((e,t)=>({items:[],addItem:t=>{e(e=>e.items.find(e=>e.id===t.id)?e:{items:[...e.items,t]})},removeItem:t=>{e(e=>({items:e.items.filter(e=>e.id!==t)}))},isInWishlist:e=>t().items.some(t=>t.id===e),clearWishlist:()=>e({items:[]})}),{name:"karim-wishlist"}));(0,a.Ue)()((0,r.tJ)((e,t)=>({user:null,isAuthenticated:!1,addresses:[],login:t=>{e({user:t,isAuthenticated:!0,addresses:t.addresses})},logout:()=>{e({user:null,isAuthenticated:!1,addresses:[]})},updateProfile:t=>{e(e=>({user:e.user?{...e.user,...t}:null}))},addAddress:t=>{e(e=>({addresses:[...e.addresses,t]}))},updateAddress:(t,s)=>{e(e=>({addresses:e.addresses.map(e=>e.id===t?{...e,...s}:e)}))},removeAddress:t=>{e(e=>({addresses:e.addresses.filter(e=>e.id!==t)}))},setDefaultAddress:t=>{e(e=>({addresses:e.addresses.map(e=>({...e,isDefault:e.id===t}))}))}}),{name:"karim-user"}));let d=(0,a.Ue)()((0,r.tJ)((e,t)=>({query:"",recentSearches:[],isOpen:!1,setQuery:t=>e({query:t}),addRecentSearch:t=>{e(e=>{let s=e.recentSearches.filter(e=>e!==t);return{recentSearches:[t,...s].slice(0,10)}})},clearRecentSearches:()=>e({recentSearches:[]}),toggleSearch:()=>e(e=>({isOpen:!e.isOpen}))}),{name:"karim-search"}));(0,a.Ue)()((0,r.tJ)((e,t)=>({notifications:[],unreadCount:0,addNotification:t=>{e(e=>({notifications:[t,...e.notifications],unreadCount:e.unreadCount+1}))},markAsRead:t=>{e(e=>({notifications:e.notifications.map(e=>e.id===t?{...e,isRead:!0}:e),unreadCount:Math.max(0,e.unreadCount-1)}))},markAllAsRead:()=>{e(e=>({notifications:e.notifications.map(e=>({...e,isRead:!0})),unreadCount:0}))},clearNotifications:()=>e({notifications:[],unreadCount:0})}),{name:"karim-notifications"}));let l=(0,a.Ue)(e=>({isMobileMenuOpen:!1,isFilterOpen:!1,viewMode:"grid",toggleMobileMenu:()=>e(e=>({isMobileMenuOpen:!e.isMobileMenuOpen})),toggleFilter:()=>e(e=>({isFilterOpen:!e.isFilterOpen})),setViewMode:t=>e({viewMode:t})}))},4033:function(e,t,s){e.exports=s(5313)}},function(e){e.O(0,[6221,2749,4356,2971,4938,1744],function(){return e(e.s=3271)}),_N_E=e.O()}]);