(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2413],{1090:function(e,t,a){Promise.resolve().then(a.bind(a,3086))},3086:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return R}});var s=a(7437),i=a(2265),r=a(2749),n=a(4033),o=a(4322),l=a(6643),c=a(1961),d=a(1738),u=a(4822),x=a(4056),m=a(3021),f=a(690),h=a(1827),p=a(2482),y=a(2442),g=a(1138),j=a(4656),N=a(7070),v=a(573),b=a(1396),w=a.n(b);function R(){let{data:e,status:t}=(0,r.useSession)(),a=(0,n.useRouter)(),[b,R]=(0,i.useState)(!0),[C,E]=(0,i.useState)("all"),[k,D]=(0,i.useState)(""),{notifications:O,unreadCount:T,setNotifications:L,markAsRead:S,markAllAsRead:M,removeNotification:z}=(0,j.G)();(0,i.useEffect)(()=>{"unauthenticated"===t&&a.push("/auth/login")},[t,a]);let A=async()=>{if(null==e?void 0:e.user){R(!0);try{let e=await fetch("/api/user/notifications?limit=50");if(e.ok){let t=await e.json();L(t.notifications||[])}}catch(e){console.error("Failed to fetch notifications:",e)}finally{R(!1)}}};(0,i.useEffect)(()=>{(null==e?void 0:e.user)&&A()},[e]);let Z=async e=>{try{(await fetch("/api/user/notifications",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({notificationIds:[e]})})).ok&&S(e)}catch(e){console.error("Failed to mark notification as read:",e)}},P=async()=>{try{(await fetch("/api/user/notifications",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({markAll:!0})})).ok&&M()}catch(e){console.error("Failed to mark all notifications as read:",e)}},I=async e=>{try{(await fetch("/api/user/notifications?id=".concat(e),{method:"DELETE"})).ok&&z(e)}catch(e){console.error("Failed to delete notification:",e)}},Y=e=>{switch(e){case"ORDER":return(0,s.jsx)(o.Z,{size:20,className:"text-blue-500"});case"PROMOTION":return(0,s.jsx)(l.Z,{size:20,className:"text-pink-500"});case"DELIVERY":return(0,s.jsx)(c.Z,{size:20,className:"text-green-500"});case"PAYMENT":return(0,s.jsx)(d.Z,{size:20,className:"text-purple-500"});case"WALLET":return(0,s.jsx)(u.Z,{size:20,className:"text-amber-500"});default:return(0,s.jsx)(x.Z,{size:20,className:"text-gray-500"})}},W=e=>{var t,a;switch(e.type){case"ORDER":case"DELIVERY":return(null===(t=e.data)||void 0===t?void 0:t.orderId)?"/account/orders/".concat(e.data.orderId):"/account/orders";case"WALLET":return"/account/wallet";case"PROMOTION":return(null===(a=e.data)||void 0===a?void 0:a.promoLink)||"/offers";default:return null}},_=O.filter(e=>{if("all"!==C&&e.type!==C)return!1;if(k){let t=k.toLowerCase();return e.title.toLowerCase().includes(t)||e.message.toLowerCase().includes(t)}return!0}),U=_.reduce((e,t)=>{let a;let s=new Date(t.createdAt),i=new Date,r=new Date(i);return r.setDate(r.getDate()-1),e[a=s.toDateString()===i.toDateString()?"Today":s.toDateString()===r.toDateString()?"Yesterday":(0,N.WU)(s,"MMMM d, yyyy")]||(e[a]=[]),e[a].push(t),e},{});return"loading"===t||b?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-12 h-12 border-3 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-500",children:"Loading notifications..."})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,s.jsxs)("div",{className:"container-custom max-w-4xl",children:[(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 mb-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-primary-100 rounded-xl flex items-center justify-center",children:(0,s.jsx)(m.Z,{size:24,className:"text-primary-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Notifications"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:T>0?"".concat(T," unread notifications"):"All caught up!"})]})]}),T>0&&(0,s.jsxs)("button",{onClick:P,className:"flex items-center gap-2 px-4 py-2 bg-primary-50 text-primary-600 rounded-lg hover:bg-primary-100 transition-colors font-medium",children:[(0,s.jsx)(f.Z,{size:18}),"Mark all as read"]})]}),(0,s.jsxs)("div",{className:"mt-6 flex flex-col sm:flex-row gap-4",children:[(0,s.jsxs)("div",{className:"relative flex-1",children:[(0,s.jsx)(h.Z,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),(0,s.jsx)("input",{type:"text",placeholder:"Search notifications...",value:k,onChange:e=>D(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(p.Z,{size:18,className:"text-gray-400"}),(0,s.jsxs)("select",{value:C,onChange:e=>E(e.target.value),className:"px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent bg-white",children:[(0,s.jsx)("option",{value:"all",children:"All Types"}),(0,s.jsx)("option",{value:"ORDER",children:"Orders"}),(0,s.jsx)("option",{value:"DELIVERY",children:"Delivery"}),(0,s.jsx)("option",{value:"PROMOTION",children:"Promotions"}),(0,s.jsx)("option",{value:"PAYMENT",children:"Payments"}),(0,s.jsx)("option",{value:"WALLET",children:"Wallet"}),(0,s.jsx)("option",{value:"SYSTEM",children:"System"})]})]})]})]}),0===_.length?(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-12 text-center",children:[(0,s.jsx)("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)(m.Z,{size:40,className:"text-gray-400"})}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:k||"all"!==C?"No notifications found":"No notifications yet"}),(0,s.jsx)("p",{className:"text-gray-500",children:k||"all"!==C?"Try adjusting your search or filters":"We'll notify you about your orders, offers, and more"})]}):(0,s.jsx)("div",{className:"space-y-6",children:Object.entries(U).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-500 mb-3 px-2",children:t}),(0,s.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden divide-y divide-gray-100",children:a.map(e=>{let t=W(e);return(0,s.jsx)("div",{className:"p-4 hover:bg-gray-50 transition-colors ".concat(e.isRead?"":"bg-primary-50/30"),children:(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("div",{className:"flex-shrink-0 w-12 h-12 rounded-xl flex items-center justify-center ".concat(e.isRead?"bg-gray-100":"bg-white shadow-sm border border-gray-100"),children:Y(e.type)}),(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("p",{className:"font-medium ".concat(e.isRead?"text-gray-700":"text-gray-900"),children:e.title}),!e.isRead&&(0,s.jsx)("span",{className:"w-2 h-2 bg-primary-500 rounded-full"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:e.message}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-2",children:(0,v.Q)(new Date(e.createdAt),{addSuffix:!0})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[!e.isRead&&(0,s.jsx)("button",{onClick:()=>Z(e.id),className:"p-2 text-gray-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"Mark as read",children:(0,s.jsx)(y.Z,{size:18})}),(0,s.jsx)("button",{onClick:()=>I(e.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"Delete",children:(0,s.jsx)(g.Z,{size:18})}),t&&(0,s.jsx)(w(),{href:t,className:"px-3 py-1.5 bg-primary-50 text-primary-600 text-sm font-medium rounded-lg hover:bg-primary-100 transition-colors",children:"View"})]})]})})]})},e.id)})})]},t)})})]})})}},4656:function(e,t,a){"use strict";a.d(t,{G:function(){return s}});let s=(0,a(4660).Ue)((e,t)=>({notifications:[],unreadCount:0,setNotifications:t=>e({notifications:t,unreadCount:t.filter(e=>!e.isRead).length}),setUnreadCount:t=>e({unreadCount:t}),addNotification:t=>e(e=>({notifications:[t,...e.notifications],unreadCount:e.unreadCount+(t.isRead?0:1)})),markAsRead:t=>e(e=>{let a=e.notifications.find(e=>e.id===t);return!a||a.isRead?e:{notifications:e.notifications.map(e=>e.id===t?{...e,isRead:!0}:e),unreadCount:Math.max(0,e.unreadCount-1)}}),markAllAsRead:()=>e(e=>({notifications:e.notifications.map(e=>({...e,isRead:!0})),unreadCount:0})),removeNotification:t=>e(e=>{let a=e.notifications.find(e=>e.id===t);return{notifications:e.notifications.filter(e=>e.id!==t),unreadCount:a&&!a.isRead?Math.max(0,e.unreadCount-1):e.unreadCount}}),clearNotifications:()=>e({notifications:[],unreadCount:0})}))}},function(e){e.O(0,[6221,2749,4548,8350,2971,4938,1744],function(){return e(e.s=1090)}),_N_E=e.O()}]);