(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9346],{3574:function(e,s,r){Promise.resolve().then(r.bind(r,4559))},4559:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return Z}});var a=r(7437),t=r(2265),l=r(1396),n=r.n(l),i=r(2749),c=r(4033),o=r(7972),d=r(4322),m=r(7810),x=r(6142),h=r(4822),u=r(3021),p=r(6264),g=r(7158),b=r(5883),f=r(5589),j=r(9617),y=r(6712),w=r(2549),N=r(6245),v=r(7216),P=r(9670),k=r(5925);let C=[{href:"/account",icon:o.Z,label:"Profile"},{href:"/account/orders",icon:d.Z,label:"My Orders"},{href:"/wishlist",icon:m.Z,label:"Wishlist"},{href:"/account/addresses",icon:x.Z,label:"Addresses"},{href:"/account/wallet",icon:h.Z,label:"Wallet"},{href:"/account/notifications",icon:u.Z,label:"Notifications"}];function Z(){var e,s,r,l,o,m;let{data:x,status:h,update:u}=(0,i.useSession)(),Z=(0,c.useRouter)(),S=(0,c.usePathname)(),[E,z]=(0,t.useState)(null),[O,A]=(0,t.useState)(!0),[D,_]=(0,t.useState)([]),[L,U]=(0,t.useState)(!1),[I,T]=(0,t.useState)(!1),[F,M]=(0,t.useState)(!1),[R,W]=(0,t.useState)({name:"",phone:""}),[q,J]=(0,t.useState)({currentPassword:"",newPassword:"",confirmPassword:""}),[V,B]=(0,t.useState)(!1),[H,$]=(0,t.useState)(!1);(0,t.useEffect)(()=>{if("unauthenticated"===h){Z.push("/login?callbackUrl=/account");return}"authenticated"===h&&(G(),K())},[h,Z]);let G=async()=>{try{let e=await fetch("/api/user/profile");if(e.ok){let s=await e.json();z(s)}}catch(e){console.error("Error fetching profile:",e)}finally{A(!1)}},K=async()=>{try{let e=await fetch("/api/orders?limit=3");if(e.ok){let s=await e.json();_(s.orders||[])}}catch(e){console.error("Error fetching orders:",e)}},Q=async()=>{if(!R.name.trim()){k.ZP.error("Name is required");return}if(R.phone&&!/^[6-9]\d{9}$/.test(R.phone)){k.ZP.error("Please enter a valid 10-digit Indian mobile number");return}M(!0);try{let e=await fetch("/api/user/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:R.name.trim(),phone:R.phone||void 0})});if(e.ok){let s=await e.json();z({...E,...s}),await u({name:R.name.trim()}),k.ZP.success("Profile updated successfully"),U(!1)}else{let s=await e.json();k.ZP.error(s.error||"Failed to update profile")}}catch(e){console.error("Error updating profile:",e),k.ZP.error("Something went wrong")}finally{M(!1)}},X=async()=>{if(!q.currentPassword){k.ZP.error("Current password is required");return}if(q.newPassword.length<6){k.ZP.error("New password must be at least 6 characters");return}if(q.newPassword!==q.confirmPassword){k.ZP.error("Passwords do not match");return}M(!0);try{let e=await fetch("/api/user/profile",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:q.currentPassword,newPassword:q.newPassword})});if(e.ok)k.ZP.success("Password changed successfully"),T(!1);else{let s=await e.json();k.ZP.error(s.error||"Failed to change password")}}catch(e){console.error("Error changing password:",e),k.ZP.error("Something went wrong")}finally{M(!1)}};if("loading"===h||O)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)(p.Z,{className:"w-8 h-8 animate-spin text-primary-600"})});if("unauthenticated"===h)return null;let Y=E||{name:(null==x?void 0:null===(e=x.user)||void 0===e?void 0:e.name)||"User",email:(null==x?void 0:null===(s=x.user)||void 0===s?void 0:s.email)||"",phone:null,createdAt:new Date().toISOString(),wallet:{balance:0},_count:{orders:0}};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8",children:[(0,a.jsxs)("div",{className:"container-custom",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"My Account"}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-4 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-1",children:[(0,a.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-2xl font-bold text-primary-600",children:(null===(l=Y.name)||void 0===l?void 0:null===(r=l.charAt(0))||void 0===r?void 0:r.toUpperCase())||"U"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-semibold text-gray-800",children:Y.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:Y.email})]})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-4 mb-4 grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-primary-600",children:(null===(o=Y._count)||void 0===o?void 0:o.orders)||0}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Total Orders"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("p",{className:"text-2xl font-bold text-primary-600",children:["₹",(null===(m=Y.wallet)||void 0===m?void 0:m.balance)||0]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Wallet Balance"})]})]}),(0,a.jsxs)("nav",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[C.map(e=>{let s=e.icon,r=S===e.href;return(0,a.jsxs)(n(),{href:e.href,className:"flex items-center gap-3 px-4 py-3 border-b last:border-b-0 transition-colors ".concat(r?"bg-primary-50 text-primary-600":"text-gray-700 hover:bg-gray-50"),children:[(0,a.jsx)(s,{size:20}),(0,a.jsx)("span",{className:"flex-1",children:e.label}),(0,a.jsx)(g.Z,{size:18,className:"text-gray-400"})]},e.href)}),(0,a.jsxs)("button",{onClick:()=>{(0,i.signOut)({callbackUrl:"/"})},className:"w-full flex items-center gap-3 px-4 py-3 text-red-600 hover:bg-red-50 transition-colors",children:[(0,a.jsx)(b.Z,{size:20}),(0,a.jsx)("span",{children:"Logout"})]})]})]}),(0,a.jsxs)("div",{className:"lg:col-span-3",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Personal Information"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>{J({currentPassword:"",newPassword:"",confirmPassword:""}),T(!0)},className:"flex items-center gap-2 px-3 py-1.5 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(f.Z,{size:16}),"Change Password"]}),(0,a.jsxs)("button",{onClick:()=>{var e;W({name:(null==E?void 0:E.name)||(null==x?void 0:null===(e=x.user)||void 0===e?void 0:e.name)||"",phone:(null==E?void 0:E.phone)||""}),U(!0)},className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[(0,a.jsx)(j.Z,{size:16}),"Edit Profile"]})]})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-500 mb-1",children:"Full Name"}),(0,a.jsx)("p",{className:"font-medium text-gray-800",children:Y.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-500 mb-1",children:"Email"}),(0,a.jsx)("p",{className:"font-medium text-gray-800",children:Y.email})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-500 mb-1",children:"Phone"}),(0,a.jsx)("p",{className:"font-medium text-gray-800",children:Y.phone||"Not provided"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-gray-500 mb-1",children:"Member Since"}),(0,a.jsx)("p",{className:"font-medium text-gray-800",children:new Date(Y.createdAt).toLocaleDateString("en-US",{month:"long",year:"numeric"})})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Recent Orders"}),(0,a.jsx)(n(),{href:"/account/orders",className:"text-primary-600 font-medium hover:text-primary-700",children:"View All"})]}),D.length>0?(0,a.jsx)("div",{className:"space-y-4",children:D.map(e=>{var s;return(0,a.jsxs)(n(),{href:"/account/orders/".concat(e.id),className:"flex items-center justify-between p-4 border rounded-lg hover:border-primary-300 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(y.Z,{className:"text-primary-600",size:24})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium text-gray-800",children:["Order #",e.orderNumber]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[new Date(e.createdAt).toLocaleDateString()," • ",(null===(s=e.items)||void 0===s?void 0:s.length)||0," items"]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-semibold text-gray-800",children:["₹",e.total]}),(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full ".concat("DELIVERED"===e.status?"bg-green-100 text-green-700":"CANCELLED"===e.status?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"),children:e.status})]})]},e.id)})}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(d.Z,{className:"text-gray-400",size:32})}),(0,a.jsx)("h3",{className:"font-medium text-gray-800 mb-2",children:"No orders yet"}),(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"Start shopping to see your orders here"}),(0,a.jsx)(n(),{href:"/products",className:"btn-primary inline-block",children:"Start Shopping"})]})]})]})]})]}),L&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl w-full max-w-md",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Edit Profile"}),(0,a.jsx)("button",{onClick:()=>U(!1),className:"p-1 hover:bg-gray-100 rounded",children:(0,a.jsx)(w.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Full Name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:R.name,onChange:e=>W({...R,name:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Enter your full name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",value:Y.email,disabled:!0,className:"w-full px-3 py-2 border rounded-lg bg-gray-50 text-gray-500 cursor-not-allowed"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),(0,a.jsx)("input",{type:"tel",value:R.phone,onChange:e=>W({...R,phone:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Enter 10-digit mobile number",maxLength:10}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Indian mobile number (e.g., 9876543210)"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3 p-4 border-t bg-gray-50",children:[(0,a.jsx)("button",{onClick:()=>U(!1),className:"px-4 py-2 border rounded-lg hover:bg-gray-50 text-sm",children:"Cancel"}),(0,a.jsxs)("button",{onClick:Q,disabled:F,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 flex items-center gap-2 text-sm",children:[F?(0,a.jsx)(p.Z,{size:16,className:"animate-spin"}):(0,a.jsx)(N.Z,{size:16}),"Save Changes"]})]})]})}),I&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl w-full max-w-md",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Change Password"}),(0,a.jsx)("button",{onClick:()=>T(!1),className:"p-1 hover:bg-gray-100 rounded",children:(0,a.jsx)(w.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Current Password ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:V?"text":"password",value:q.currentPassword,onChange:e=>J({...q,currentPassword:e.target.value}),className:"w-full px-3 py-2 pr-10 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Enter current password"}),(0,a.jsx)("button",{type:"button",onClick:()=>B(!V),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:V?(0,a.jsx)(v.Z,{size:18}):(0,a.jsx)(P.Z,{size:18})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["New Password ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:H?"text":"password",value:q.newPassword,onChange:e=>J({...q,newPassword:e.target.value}),className:"w-full px-3 py-2 pr-10 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Enter new password"}),(0,a.jsx)("button",{type:"button",onClick:()=>$(!H),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:H?(0,a.jsx)(v.Z,{size:18}):(0,a.jsx)(P.Z,{size:18})})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Must be at least 6 characters"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Confirm New Password ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"password",value:q.confirmPassword,onChange:e=>J({...q,confirmPassword:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Confirm new password"}),q.confirmPassword&&q.newPassword!==q.confirmPassword&&(0,a.jsx)("p",{className:"text-xs text-red-500 mt-1",children:"Passwords do not match"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-3 p-4 border-t bg-gray-50",children:[(0,a.jsx)("button",{onClick:()=>T(!1),className:"px-4 py-2 border rounded-lg hover:bg-gray-50 text-sm",children:"Cancel"}),(0,a.jsxs)("button",{onClick:X,disabled:F||q.newPassword!==q.confirmPassword,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 flex items-center gap-2 text-sm",children:[F?(0,a.jsx)(p.Z,{size:16,className:"animate-spin"}):(0,a.jsx)(f.Z,{size:16}),"Change Password"]})]})]})})]})}}},function(e){e.O(0,[6221,2749,9007,2971,4938,1744],function(){return e(e.s=3574)}),_N_E=e.O()}]);